<?xml version="1.0" encoding="UTF-8"?>
<pd:ProcessDefinition xmlns:pfx16="http://www.ericsson.com/ZainKW/BusinessSchemas/Services/Provisioning/CreateCustomerReq.xsd" xmlns:BW="java://com.tibco.pe.core.JavaCustomXPATHFunctions" xmlns:pfx15="http://www.ericsson.com/Mozaic/BusinessSchemas/Modification/BillDeliveryMethodRequest.xsd" xmlns:ns="http://www.tibco.com/pe/CheckpointSchema" xmlns:pfx14="http://www.ericsson.com/Mozaic/BusinessSchemas/Query/RTARequest.xsd" xmlns:pfx13="http://www.ericsson.com/Mozaic/BusinessSchemas/Query/GetBalanceInfoReq.xsd" xmlns:pfx12="http://www.ericsson.com/Mozaic/BusinessSchemas/Modification/AddressChangeReq.xsd" xmlns:pfx11="http://www.ericsson.com/CDM/telecom/canonicaldatamodel" xmlns:pfx10="http://schemas.tibco.com/bw/pe/plugin/5.0/exceptions" xmlns:zainesbcustom="java://com.commonresources.utilities.CustomFunctions" xmlns:pfx19="http://www.ericsson.com/ZainKW/BusinessSchemas/Services/Provisioning/ModifyCustomerReq.xsd" xmlns:pfx18="http://www.ericsson.com/ZainKW/BusinessSchemas/Services/Modification/DemographicChangeRequest.xsd" xmlns:pfx17="http://www.ericsson.com/ZainKW/BusinessSchemas/Services/Modification/AddressChangeRequest.xsd" xmlns:zainKW="java://com.ZainKW.CurrentNanoSecconds" xmlns:pfx5="http://xmlns.zain.jo.org/CDM/CustomerAndOrder" xmlns:tib="http://www.tibco.com/bw/xslt/custom-functions" xmlns:pfx4="http://www.tibco.com/CommonLE2/namespace/Public/Exception/ExceptionRequest.xsd" xmlns:pfx3="http://www.tibco.com/ns/no_namespace_schema_location/CustomerAndOrder.xsd" xmlns:pfx2="http://www.ericsson.com/EAI/SchemaDefinitions/CDM/customerAccount" xmlns:pfx9="http://www.tibco.com/pe/GenerateErrorActivity/InputSchema" xmlns:pfx8="http://www.siebel.com/xml/MOZ1%20Serv%20Account%20Creation%20Res" xmlns:pfx7="http://www.tibco.com/ns/no_namespace_schema_location/CDM/CDM.xsd" xmlns:pfx6="http://www.tibco.com/CommonLE2/namespace/Public/Common/RequestHeader.xsd" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:ns9="http://www.ericsson.com/ZainKW/BusinessSchemas/Services/Provisioning/ModifyCustomerRes.xsd" xmlns:ns5="http://www.ericsson.com/Mozaic/BusinessSchemas/Provisioning/CreateCustomerRes.xsd" xmlns:ns6="http://www.ericsson.com/Mozaic/BusinessSchemas/Modification/AddressChangeRes.xsd" xmlns:pfx="http://www.tibco.com/namespaces/tnt/plugins/jms" xmlns:ns7="http://www.ericsson.com/Mozaic/BusinessSchemas/Query/GetBalanceInfoRes.xsd" xmlns:ns10="http://ericsson.com/services/ws_CIL_5" xmlns:ns8="http://www.ericsson.com/Mozaic/BusinessSchemas/Query/RTAResponse.xsd" xmlns:pd="http://xmlns.tibco.com/bw/process/2003" xmlns:ns2="http://www.tibco.com/CommonLE2/namespace/Public/Logging/LogRequest.xsd" xmlns:ns1="http://www.tibco.com/pe/EngineTypes" xmlns:ns4="http://www.tibco.com/pe/DeployedVarsType" xmlns:ns3="http://www.tibco.com/pe/WriteToLogActivitySchema" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:pfx22="http://www.zain.com/ZESB/Services/KnetPayment/Types" xmlns:pfx23="http://www.tibco.com/ns/no_namespace_schema_location/BusinessProcesses/Services/New_KNET_CreateOrder/KNETPaymentsSB/KNETPaymentsSB.xsd" xmlns:pfx20="http://www.ericsson.com/ZainKW/BusinessSchemas/Services/Applications/ConceptWave/PaymentTransaction.xsd" xmlns:pfx21="http://www.ericsson.com/ZainKW/BusinessSchemas/Services/Applications/Common/ProcessKNETPayments.xsd" xmlns:pfx24="http://www.xmlns.zain.com/BSS/ESB/ZainKWFault.xsd" xmlns:pfx25="http://www.zain.com/ZESB/Types/Common">
    <xsd:import namespace="http://www.ericsson.com/EAI/SchemaDefinitions/CDM/customerAccount" schemaLocation="/CDM/customerAccount.xsd"/>
    <xsd:import namespace="http://www.tibco.com/ns/no_namespace_schema_location/CustomerAndOrder.xsd" schemaLocation="/CustomerAndOrder.xsd"/>
    <xsd:import namespace="http://xmlns.zain.jo.org/CDM/CustomerAndOrder"/>
    <xsd:import namespace="http://www.ericsson.com/CDM/telecom/canonicaldatamodel" schemaLocation="/CDM/CDM.xsd"/>
    <xsd:import namespace="http://www.tibco.com/CommonLE2/namespace/Public/Exception/ExceptionRequest.xsd" schemaLocation="/BusinessSchemas/Common/CLE/ExceptionRequest.xsd"/>
    <xsd:import namespace="http://www.ericsson.com/Mozaic/BusinessSchemas/Modification/AddressChangeReq.xsd" schemaLocation="/BusinessSchemas/Services/Modification/AddressChange/AddressChangeReq.xsd"/>
    <xsd:import namespace="http://www.ericsson.com/Mozaic/BusinessSchemas/Query/GetBalanceInfoReq.xsd" schemaLocation="/BusinessSchemas/Services/Query/GetBalance/GetBalanceInfoReq.xsd"/>
    <xsd:import namespace="http://www.ericsson.com/Mozaic/BusinessSchemas/Query/RTARequest.xsd" schemaLocation="/BusinessSchemas/Services/Query/RTA/RTARequest.xsd"/>
    <xsd:import namespace="http://www.ericsson.com/Mozaic/BusinessSchemas/Modification/BillDeliveryMethodRequest.xsd" schemaLocation="/BusinessSchemas/Services/Modification/BillDeliveryMethod/BillDeliveryMethodRequest.xsd"/>
    <xsd:import namespace="http://www.ericsson.com/ZainKW/BusinessSchemas/Services/Provisioning/CreateCustomerReq.xsd" schemaLocation="/BusinessSchemas/Services/Provisioning/CreateCustomer/CreateCustomerReq.xsd"/>
    <xsd:import namespace="http://www.ericsson.com/ZainKW/BusinessSchemas/Services/Modification/AddressChangeRequest.xsd" schemaLocation="/BusinessSchemas/Services/Modification/AddressChange/AddressChangeRequest.xsd"/>
    <xsd:import namespace="http://www.ericsson.com/ZainKW/BusinessSchemas/Services/Modification/DemographicChangeRequest.xsd" schemaLocation="/BusinessSchemas/Services/Modification/DemographicChange/DemographicChangeRequest.xsd"/>
    <xsd:import namespace="http://www.ericsson.com/ZainKW/BusinessSchemas/Services/Provisioning/ModifyCustomerReq.xsd" schemaLocation="/BusinessSchemas/Services/Modification/ModifyCustomer/ModifyCustomerReq.xsd"/>
    <xsd:import namespace="http://www.ericsson.com/ZainKW/BusinessSchemas/Services/Provisioning/ModifyCustomerRes.xsd" schemaLocation="/BusinessSchemas/Services/Modification/ModifyCustomer/ModifyCustomerRes.xsd"/>
    <xsd:import namespace="http://www.ericsson.com/ZainKW/BusinessSchemas/Services/Applications/ConceptWave/PaymentTransaction.xsd" schemaLocation="/BusinessSchemas/Services/Applications/ConceptWave/PaymentTransaction/PaymentTransaction.xsd"/>
    <xsd:import namespace="http://www.tibco.com/ns/no_namespace_schema_location/BusinessProcesses/Services/New_KNET_CreateOrder/KNETPaymentsSB/KNETPaymentsSB.xsd" schemaLocation="/BusinessProcesses/Services/New_KNET_CreateOrder/KNETPaymentsSB/KNETPaymentsSB.xsd"/>
    <xsd:import namespace="http://www.zain.com/ZESB/Types/Common" schemaLocation="/BusinessWSDLS/Services/WSDLS/KentPayment/KentPaymentInbound.wsdl"/>
    <pd:name>BusinessProcesses/Services/New_KNET_CreateOrder/Implementation/KNETPayment.process</pd:name>
    <pd:startName>JMS Queue Receiver</pd:startName>
    <pd:startX>0</pd:startX>
    <pd:startY>0</pd:startY>
    <pd:returnBindings>
        <root/>
    </pd:returnBindings>
    <pd:starter name="JMS Queue Receiver">
        <pd:type>com.tibco.plugin.jms.JMSQueueEventSource</pd:type>
        <pd:resourceType>ae.activities.JMSQueueEventSource</pd:resourceType>
        <pd:x>65</pd:x>
        <pd:y>35</pd:y>
        <config>
            <PermittedMessageType>Text</PermittedMessageType>
            <SessionAttributes>
                <transacted>false</transacted>
                <acknowledgeMode>1</acknowledgeMode>
                <maxSessions>1</maxSessions>
                <destination>%%BunisessProcesses/Services/Transaction/ProcessKNETPayments/Request_Queue%%</destination>
            </SessionAttributes>
            <ConfigurableHeaders>
                <JMSDeliveryMode>PERSISTENT</JMSDeliveryMode>
                <JMSExpiration>0</JMSExpiration>
                <JMSPriority>4</JMSPriority>
            </ConfigurableHeaders>
            <ConnectionReference>/CommonResources/Connections/JMS/Internal/EAI_EMSConnection.sharedjmscon</ConnectionReference>
            <ApplicationProperties>/CommonResources/Connections/JMS/Internal/EAI_EMSApplicationProperties.sharedjmsapp</ApplicationProperties>
        </config>
        <pd:inputBindings/>
    </pd:starter>
    <pd:endName>End</pd:endName>
    <pd:endX>1072</pd:endX>
    <pd:endY>250</pd:endY>
    <pd:errorSchemas/>
    <pd:processVariables/>
    <pd:targetNamespace>http://xmlns.example.com/1323152787082</pd:targetNamespace>
    <pd:activity name="Map_Params">
        <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
        <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
        <pd:x>874</pd:x>
        <pd:y>35</pd:y>
        <config>
            <element>
                <xsd:element name="root">
                    <xsd:complexType>
                        <xsd:sequence>
                            <xsd:element name="group" minOccurs="0" maxOccurs="unbounded">
                                <xsd:complexType>
                                    <xsd:sequence>
                                        <xsd:element name="Name" type="xsd:string" minOccurs="0"/>
                                        <xsd:element name="Value" type="xsd:string" minOccurs="0"/>
                                    </xsd:sequence>
                                </xsd:complexType>
                            </xsd:element>
                        </xsd:sequence>
                    </xsd:complexType>
                </xsd:element>
            </element>
        </config>
        <pd:inputBindings>
            <root>
                <xsl:for-each select="$Parse-XML-1/pfx22:CreateOrderInput/pfx22:Params/pfx22:Param">
                    <xsl:variable name="var" select="position()"/>
                    <group>
                        <Name>
                            <xsl:value-of select="pfx22:Name"/>
                        </Name>
                        <Value>
                            <xsl:value-of select="$DP_URLEncoded/AccumulatedOutput/javaCodeActivityOutput[$var]/DP_UEValue"/>
                        </Value>
                    </group>
                </xsl:for-each>
            </root>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Transform XML">
        <pd:type>com.tibco.plugin.xml.XMLTransformActivity</pd:type>
        <pd:resourceType>ae.activities.XMLTransformActivity</pd:resourceType>
        <pd:x>1007</pd:x>
        <pd:y>35</pd:y>
        <config>
            <inputStyle>text</inputStyle>
            <engine>TibcoXML</engine>
            <stylesheet>/BusinessProcesses/Services/New_KNET_CreateOrder/DP_To_P.xslt</stylesheet>
        </config>
        <pd:inputBindings>
            <textInput>
                <xmlString>
                    <xsl:value-of select="tib:render-xml($Map_Params/root)"/>
                </xmlString>
            </textInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Parse XML">
        <pd:type>com.tibco.plugin.xml.XMLParseActivity</pd:type>
        <pd:resourceType>ae.activities.XMLParseActivity</pd:resourceType>
        <pd:x>1121</pd:x>
        <pd:y>35</pd:y>
        <config>
            <inputStyle>text</inputStyle>
            <xsdVersion>default</xsdVersion>
            <validateOutput>true</validateOutput>
            <term>
                <xsd:element name="root">
                    <xsd:complexType>
                        <xsd:sequence>
                            <xsd:any minOccurs="0" maxOccurs="unbounded" processContents="skip"/>
                        </xsd:sequence>
                    </xsd:complexType>
                </xsd:element>
            </term>
        </config>
        <pd:inputBindings>
            <xmlString>
                <xsl:value-of select="$Transform-XML/xmlString"/>
            </xmlString>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="HTTP_String">
        <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
        <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
        <pd:x>273</pd:x>
        <pd:y>247</pd:y>
        <config>
            <element>
                <xsd:element name="root">
                    <xsd:complexType>
                        <xsd:sequence>
                            <xsd:element name="String" type="xsd:anyURI"/>
                        </xsd:sequence>
                    </xsd:complexType>
                </xsd:element>
            </element>
        </config>
        <pd:inputBindings>
            <root>
                <String>
                    <xsl:value-of select="concat($Transform-Parameters/xmlString,'&amp;',$Transform-DP/xmlString)"/>
                </String>
            </root>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Map_Initial_Data">
        <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
        <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
        <pd:x>516</pd:x>
        <pd:y>35</pd:y>
        <config>
            <element ref="pfx23:root"/>
        </config>
        <pd:inputBindings>
            <root>
                <MSISDN>
                    <xsl:value-of select="$Parse-XML-1/pfx22:CreateOrderInput/pfx22:Msisdn"/>
                </MSISDN>
                <Amount>
                    <xsl:value-of select="$Parse-XML-1/pfx22:CreateOrderInput/pfx22:Amount"/>
                </Amount>
                <OrderID>
                    <xsl:value-of select="$Parse-XML-1/pfx22:CreateOrderInput/pfx22:OrderID"/>
                </OrderID>
                <returnURL>
                    <xsl:value-of select="$Java-Code-1/javaCodeActivityOutput/Return_URL"/>
                </returnURL>
                <ErrorURL>
                    <xsl:value-of select="$Java-Code-1/javaCodeActivityOutput/Error_URL"/>
                </ErrorURL>
                <xsl:choose>
                    <xsl:when test="string-length($Java-Code-1/javaCodeActivityOutput/Order_DESC)>0">
                        <OrderDesc>
                            <xsl:value-of select="$Java-Code-1/javaCodeActivityOutput/Order_DESC"/>
                        </OrderDesc>
                    </xsl:when>
                    <xsl:otherwise>
                        <OrderDesc>
                            <xsl:value-of select="$Parse-XML-1/pfx22:CreateOrderInput/pfx22:OrderID"/>
                        </OrderDesc>
                    </xsl:otherwise>
                </xsl:choose>
                <lang>
                    <xsl:value-of select="$Parse-XML-1/pfx22:CreateOrderInput/pfx22:Language"/>
                </lang>
                <xsl:if test="string-length($Parse-XML-1/pfx22:CreateOrderInput/pfx22:CardNumber)>0">
                    <CardNo>
                        <xsl:value-of select="$Parse-XML-1/pfx22:CreateOrderInput/pfx22:CardNumber"/>
                    </CardNo>
                </xsl:if>
                <xsl:if test="string-length($Parse-XML-1/pfx22:CreateOrderInput/pfx22:CardExpiry)>0">
                    <CardExp>
                        <xsl:value-of select="$Parse-XML-1/pfx22:CreateOrderInput/pfx22:CardExpiry"/>
                    </CardExp>
                </xsl:if>
                <xsl:choose>
                    <xsl:when test="string-length($Parse-XML-1/pfx22:CreateOrderInput/pfx22:HandlerClass)=0">
                        <actionClassName>
                            <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/BunisessProcesses/Services/Transaction/ProcessKNETPayments/Generic_actionClassName"/>
                        </actionClassName>
                    </xsl:when>
                    <xsl:otherwise>
                        <actionClassName>
                            <xsl:value-of select="$Parse-XML-1/pfx22:CreateOrderInput/pfx22:HandlerClass"/>
                        </actionClassName>
                    </xsl:otherwise>
                </xsl:choose>
                <Channel>
                    <xsl:value-of select="$Parse-XML-1/pfx22:CreateOrderInput/pfx22:Channel"/>
                </Channel>
            </root>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Transform-DP">
        <pd:type>com.tibco.plugin.xml.XMLTransformActivity</pd:type>
        <pd:resourceType>ae.activities.XMLTransformActivity</pd:resourceType>
        <pd:x>47</pd:x>
        <pd:y>247</pd:y>
        <config>
            <inputStyle>text</inputStyle>
            <engine>TibcoXML</engine>
            <stylesheet>/BusinessProcesses/Services/New_KNET_CreateOrder/XML_To_String.xslt</stylesheet>
        </config>
        <pd:inputBindings>
            <textInput>
                <xmlString>
                    <xsl:value-of select="tib:render-xml($Parse-XML/root)"/>
                </xmlString>
            </textInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Transform-Parameters">
        <pd:type>com.tibco.plugin.xml.XMLTransformActivity</pd:type>
        <pd:resourceType>ae.activities.XMLTransformActivity</pd:resourceType>
        <pd:x>161</pd:x>
        <pd:y>247</pd:y>
        <config>
            <inputStyle>text</inputStyle>
            <engine>TibcoXML</engine>
            <stylesheet>/BusinessProcesses/Services/New_KNET_CreateOrder/XML_To_String.xslt</stylesheet>
        </config>
        <pd:inputBindings>
            <textInput>
                <xmlString>
                    <xsl:value-of select="tib:render-xml($Map_Initial_Data/root)"/>
                </xmlString>
            </textInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Call_KNETPayment">
        <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
        <pd:resourceType>ae.process.subprocess</pd:resourceType>
        <pd:x>517</pd:x>
        <pd:y>247</pd:y>
        <config>
            <processName>/BusinessProcesses/Services/New_KNET_CreateOrder/HelperProcess/Call_KNETPayment.process</processName>
        </config>
        <pd:inputBindings>
            <group>
                <HTTP_String>
                    <xsl:value-of select="$HTTP_String/root/String"/>
                </HTTP_String>
                <TransactionID>
                    <xsl:value-of select="$JMS-Queue-Receiver/pfx:ActivityOutput/OtherProperties/TransactionID"/>
                </TransactionID>
                <StartTimeStamp>
                    <xsl:value-of select="$JMS-Queue-Receiver/pfx:ActivityOutput/OtherProperties/StartTimeStamp"/>
                </StartTimeStamp>
                <ChannelName>
                    <xsl:value-of select="$Map_Initial_Data/root/Channel"/>
                </ChannelName>
            </group>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="LogIN">
        <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
        <pd:resourceType>ae.process.subprocess</pd:resourceType>
        <pd:x>286</pd:x>
        <pd:y>35</pd:y>
        <config>
            <processName>/CommonProcesses/LoggingProcess/Logging_Message.process</processName>
        </config>
        <pd:inputBindings>
            <ns2:LogRequest>
                <pfx6:Header>
                    <pfx6:ApplicationID>
                        <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonProcesses/Constants/CLE/Header/ApplicationID"/>
                    </pfx6:ApplicationID>
                    <pfx6:ComponentName>
                        <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/BunisessProcesses/Services/Transaction/ProcessKNETPayments/ComponentName"/>
                    </pfx6:ComponentName>
                    <pfx6:Hostname>
                        <xsl:value-of select="BW:getHostName()"/>
                    </pfx6:Hostname>
                    <pfx6:Timestamp>
                        <xsl:value-of select="current-dateTime()"/>
                    </pfx6:Timestamp>
                    <pfx6:TransactionDomain>
                        <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonProcesses/Constants/CLE/Header/TransactionDomain/TRANSACTION"/>
                    </pfx6:TransactionDomain>
                    <pfx6:TransactionType>
                        <xsl:value-of select="zainesbcustom:getTransactionType(BW:getCurrentProcessName($_processContext/ns1:ProcessContext/ProcessId))"/>
                    </pfx6:TransactionType>
                    <pfx6:TransactionID>
                        <xsl:value-of select="$JMS-Queue-Receiver/pfx:ActivityOutput/OtherProperties/TransactionID"/>
                    </pfx6:TransactionID>
                    <pfx6:Message>
                        <xsl:value-of select="tib:render-xml($Parse-XML-1/pfx22:CreateOrderInput)"/>
                    </pfx6:Message>
                </pfx6:Header>
                <TimeDuration>
                    <xsl:value-of select="tib:timestamp()-$JMS-Queue-Receiver/pfx:ActivityOutput/OtherProperties/StartTimeStamp"/>
                </TimeDuration>
                <Category>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonProcesses/Constants/CLE/Category/LogRoleInfo"/>
                </Category>
                <Status>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonProcesses/Constants/CLE/Status/ESI/ESI_REQ_RECV"/>
                </Status>
                <Audit>
                    <xsl:value-of select="0"/>
                </Audit>
            </ns2:LogRequest>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="LogOUT">
        <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
        <pd:resourceType>ae.process.subprocess</pd:resourceType>
        <pd:x>665</pd:x>
        <pd:y>249</pd:y>
        <config>
            <processName>/CommonProcesses/LoggingProcess/Logging_Message.process</processName>
        </config>
        <pd:inputBindings>
            <ns2:LogRequest>
                <pfx6:Header>
                    <pfx6:ApplicationID>
                        <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonProcesses/Constants/CLE/Header/ApplicationID"/>
                    </pfx6:ApplicationID>
                    <pfx6:ComponentName>
                        <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/BunisessProcesses/Services/Transaction/ProcessKNETPayments/ComponentName"/>
                    </pfx6:ComponentName>
                    <pfx6:Hostname>
                        <xsl:value-of select="BW:getHostName()"/>
                    </pfx6:Hostname>
                    <pfx6:Timestamp>
                        <xsl:value-of select="current-dateTime()"/>
                    </pfx6:Timestamp>
                    <pfx6:TransactionDomain>
                        <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonProcesses/Constants/CLE/Header/TransactionDomain/TRANSACTION"/>
                    </pfx6:TransactionDomain>
                    <pfx6:TransactionType>
                        <xsl:value-of select="zainesbcustom:getTransactionType(BW:getCurrentProcessName($_processContext/ns1:ProcessContext/ProcessId))"/>
                    </pfx6:TransactionType>
                    <pfx6:TransactionID>
                        <xsl:value-of select="$JMS-Queue-Receiver/pfx:ActivityOutput/OtherProperties/TransactionID"/>
                    </pfx6:TransactionID>
                    <pfx6:Message>
                        <xsl:value-of select="tib:render-xml($Call_KNETPayment/*)"/>
                    </pfx6:Message>
                </pfx6:Header>
                <TimeDuration>
                    <xsl:value-of select="tib:timestamp()-$JMS-Queue-Receiver/pfx:ActivityOutput/OtherProperties/StartTimeStamp"/>
                </TimeDuration>
                <Category>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonProcesses/Constants/CLE/Category/LogRoleInfo"/>
                </Category>
                <Status>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonProcesses/Constants/CLE/Status/ESI/ESI_RES_SENT"/>
                </Status>
                <Audit>
                    <xsl:value-of select="0"/>
                </Audit>
            </ns2:LogRequest>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Parse-XML-1">
        <pd:type>com.tibco.plugin.xml.XMLParseActivity</pd:type>
        <pd:resourceType>ae.activities.XMLParseActivity</pd:resourceType>
        <pd:x>185</pd:x>
        <pd:y>35</pd:y>
        <config>
            <inputStyle>text</inputStyle>
            <xsdVersion>default</xsdVersion>
            <validateOutput>true</validateOutput>
            <term ref="pfx22:CreateOrderInput"/>
        </config>
        <pd:inputBindings>
            <xmlString>
                <xsl:value-of select="$JMS-Queue-Receiver/pfx:ActivityOutput/Body"/>
            </xmlString>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Reply to JMS Message">
        <pd:type>com.tibco.plugin.jms.JMSReplyActivity</pd:type>
        <pd:resourceType>ae.activities.JMSReplyActivity</pd:resourceType>
        <pd:x>918</pd:x>
        <pd:y>260</pd:y>
        <config>
            <PermittedMessageType>Text</PermittedMessageType>
            <SessionAttributes>
                <transacted>false</transacted>
                <acknowledgeMode>1</acknowledgeMode>
                <maxSessions>1</maxSessions>
            </SessionAttributes>
            <ConfigurableHeaders>
                <JMSDeliveryMode>PERSISTENT</JMSDeliveryMode>
                <JMSExpiration>0</JMSExpiration>
                <JMSPriority>4</JMSPriority>
                <EventSource>JMS Queue Receiver</EventSource>
            </ConfigurableHeaders>
            <ApplicationProperties>/CommonResources/Connections/JMS/Internal/EAI_EMSApplicationProperties.sharedjmsapp</ApplicationProperties>
        </config>
        <pd:inputBindings>
            <pfx:ActivityInput>
                <xsl:copy-of select="$JMS-Queue-Receiver/pfx:ActivityOutput/OtherProperties"/>
                <Body>
                    <xsl:value-of select="tib:render-xml($Map-Data/root)"/>
                </Body>
            </pfx:ActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Catch">
        <pd:type>com.tibco.pe.core.CatchActivity</pd:type>
        <pd:resourceType>ae.activities.catch</pd:resourceType>
        <pd:x>29</pd:x>
        <pd:y>411</pd:y>
        <pd:handler>true</pd:handler>
        <config>
            <catchAll>true</catchAll>
        </config>
        <pd:inputBindings/>
    </pd:activity>
    <pd:activity name="Generate Error">
        <pd:type>com.tibco.pe.core.GenerateErrorActivity</pd:type>
        <pd:resourceType>ae.activities.throw</pd:resourceType>
        <pd:x>185</pd:x>
        <pd:y>136</pd:y>
        <config>
            <faultName/>
        </config>
        <pd:inputBindings>
            <pfx9:ActivityInput>
                <message>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonErrors/ParsingErrorDesc"/>
                </message>
                <messageCode>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonErrors/ParsingErrorCode"/>
                </messageCode>
            </pfx9:ActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Generate-Error-1">
        <pd:type>com.tibco.pe.core.GenerateErrorActivity</pd:type>
        <pd:resourceType>ae.activities.throw</pd:resourceType>
        <pd:x>1124</pd:x>
        <pd:y>139</pd:y>
        <config>
            <faultName/>
        </config>
        <pd:inputBindings>
            <pfx9:ActivityInput>
                <message>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonErrors/ParsingErrorDesc"/>
                </message>
                <messageCode>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonErrors/ParsingErrorCode"/>
                </messageCode>
            </pfx9:ActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Generate-Error-2">
        <pd:type>com.tibco.pe.core.GenerateErrorActivity</pd:type>
        <pd:resourceType>ae.activities.throw</pd:resourceType>
        <pd:x>920</pd:x>
        <pd:y>353</pd:y>
        <config>
            <faultName/>
        </config>
        <pd:inputBindings>
            <pfx9:ActivityInput>
                <message>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonErrors/JMSErrorDesc"/>
                </message>
                <messageCode>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonErrors/JMSErrorCode"/>
                </messageCode>
            </pfx9:ActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Generate-Error-3">
        <pd:type>com.tibco.pe.core.GenerateErrorActivity</pd:type>
        <pd:resourceType>ae.activities.throw</pd:resourceType>
        <pd:x>69</pd:x>
        <pd:y>136</pd:y>
        <config>
            <faultName/>
        </config>
        <pd:inputBindings>
            <pfx9:ActivityInput>
                <message>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonErrors/JMSErrorDesc"/>
                </message>
                <messageCode>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonErrors/JMSErrorCode"/>
                </messageCode>
            </pfx9:ActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="LogError">
        <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
        <pd:resourceType>ae.process.subprocess</pd:resourceType>
        <pd:x>152</pd:x>
        <pd:y>413</pd:y>
        <config>
            <processName>/CommonProcesses/LoggingProcess/Logging_Message.process</processName>
        </config>
        <pd:inputBindings>
            <ns2:LogRequest>
                <pfx6:Header>
                    <pfx6:ApplicationID>
                        <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonProcesses/Constants/CLE/Header/ApplicationID"/>
                    </pfx6:ApplicationID>
                    <pfx6:ComponentName>
                        <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/BunisessProcesses/Services/Transaction/ProcessKNETPayments/ComponentName"/>
                    </pfx6:ComponentName>
                    <pfx6:Hostname>
                        <xsl:value-of select="BW:getHostName()"/>
                    </pfx6:Hostname>
                    <pfx6:Timestamp>
                        <xsl:value-of select="current-dateTime()"/>
                    </pfx6:Timestamp>
                    <pfx6:TransactionDomain>
                        <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonProcesses/Constants/CLE/Header/TransactionDomain/TRANSACTION"/>
                    </pfx6:TransactionDomain>
                    <pfx6:TransactionType>
                        <xsl:value-of select="zainesbcustom:getTransactionType(BW:getCurrentProcessName($_processContext/ns1:ProcessContext/ProcessId))"/>
                    </pfx6:TransactionType>
                    <xsl:if test="$JMS-Queue-Receiver/pfx:ActivityOutput/OtherProperties/TransactionID">
                        <pfx6:TransactionID>
                            <xsl:value-of select="$JMS-Queue-Receiver/pfx:ActivityOutput/OtherProperties/TransactionID"/>
                        </pfx6:TransactionID>
                    </xsl:if>
                    <pfx6:Message>
                        <xsl:value-of select="tib:render-xml($_error/ns1:ErrorReport)"/>
                    </pfx6:Message>
                </pfx6:Header>
                <TimeDuration>
                    <xsl:value-of select="tib:timestamp()-$JMS-Queue-Receiver/pfx:ActivityOutput/OtherProperties/StartTimeStamp"/>
                </TimeDuration>
                <Category>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonProcesses/Constants/CLE/Category/LogRoleError"/>
                </Category>
                <Status>
                    <xsl:value-of select="$_globalVariables/ns4:GlobalVariables/CommonProcesses/Constants/CLE/Status/ESI/ESI_ERR_RES_SENT"/>
                </Status>
                <Audit>
                    <xsl:value-of select="0"/>
                </Audit>
            </ns2:LogRequest>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Map_Error">
        <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
        <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
        <pd:x>267</pd:x>
        <pd:y>413</pd:y>
        <config>
            <element>
                <xsd:element name="root">
                    <xsd:complexType>
                        <xsd:sequence>
                            <xsd:element ref="pfx25:FaultType"/>
                        </xsd:sequence>
                    </xsd:complexType>
                </xsd:element>
            </element>
        </config>
        <pd:inputBindings>
            <root>
                <pfx25:FaultType>
                    <pfx25:type>
                        <xsl:value-of select="&quot;Technical&quot;"/>
                    </pfx25:type>
                    <pfx25:code>
                        <xsl:value-of select="$_error/ns1:ErrorReport/MsgCode"/>
                    </pfx25:code>
                    <pfx25:description>
                        <xsl:value-of select="$_error/ns1:ErrorReport/Msg"/>
                    </pfx25:description>
                    <pfx25:sourceSystem>
                        <xsl:value-of select="&quot;TIBCO&quot;"/>
                    </pfx25:sourceSystem>
                    <xsl:if test="$_error/ns1:ErrorReport/MsgCode">
                        <pfx25:extErrorCode>
                            <xsl:value-of select="$_error/ns1:ErrorReport/MsgCode"/>
                        </pfx25:extErrorCode>
                    </xsl:if>
                    <xsl:if test="$_error/ns1:ErrorReport/Msg">
                        <pfx25:detail>
                            <xsl:value-of select="$_error/ns1:ErrorReport/Msg"/>
                        </pfx25:detail>
                    </xsl:if>
                </pfx25:FaultType>
            </root>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Reply-to-JMS-Message-1">
        <pd:type>com.tibco.plugin.jms.JMSReplyActivity</pd:type>
        <pd:resourceType>ae.activities.JMSReplyActivity</pd:resourceType>
        <pd:x>392</pd:x>
        <pd:y>413</pd:y>
        <config>
            <PermittedMessageType>Text</PermittedMessageType>
            <SessionAttributes>
                <transacted>false</transacted>
                <acknowledgeMode>1</acknowledgeMode>
                <maxSessions>1</maxSessions>
            </SessionAttributes>
            <ConfigurableHeaders>
                <JMSDeliveryMode>PERSISTENT</JMSDeliveryMode>
                <JMSExpiration>0</JMSExpiration>
                <JMSPriority>4</JMSPriority>
                <EventSource>JMS Queue Receiver</EventSource>
            </ConfigurableHeaders>
            <ApplicationProperties>/CommonResources/Connections/JMS/Internal/EAI_EMSApplicationProperties.sharedjmsapp</ApplicationProperties>
        </config>
        <pd:inputBindings>
            <pfx:ActivityInput>
                <xsl:copy-of select="$JMS-Queue-Receiver/pfx:ActivityOutput/OtherProperties"/>
                <Body>
                    <xsl:value-of select="tib:render-xml($Map_Error)"/>
                </Body>
            </pfx:ActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Map Data">
        <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
        <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
        <pd:x>790</pd:x>
        <pd:y>252</pd:y>
        <config>
            <element>
                <xsd:element name="root">
                    <xsd:complexType>
                        <xsd:sequence>
                            <xsd:element ref="pfx25:FaultType" minOccurs="0"/>
                            <xsd:element ref="pfx22:CreateOrderOutput"/>
                        </xsd:sequence>
                    </xsd:complexType>
                </xsd:element>
            </element>
        </config>
        <pd:inputBindings>
            <root>
                <pfx25:FaultType>
                    <pfx25:type>
                        <xsl:value-of select="$Call_KNETPayment/pfx24:ErrorResponse/pfx24:Error_Type"/>
                    </pfx25:type>
                    <pfx25:code>
                        <xsl:value-of select="$Call_KNETPayment/pfx24:ErrorResponse/pfx24:Error_SourceErrCode"/>
                    </pfx25:code>
                    <pfx25:description>
                        <xsl:value-of select="$Call_KNETPayment/pfx24:ErrorResponse/pfx24:Error_SourceErrDesc"/>
                    </pfx25:description>
                    <pfx25:sourceSystem>
                        <xsl:value-of select="$Call_KNETPayment/pfx24:ErrorResponse/pfx24:Error_SourceSystem"/>
                    </pfx25:sourceSystem>
                    <xsl:if test="$Call_KNETPayment/pfx24:ErrorResponse/pfx24:Error_UserErrCode">
                        <pfx25:extErrorCode>
                            <xsl:value-of select="$Call_KNETPayment/pfx24:ErrorResponse/pfx24:Error_UserErrCode"/>
                        </pfx25:extErrorCode>
                    </xsl:if>
                    <pfx25:detail>
                        <xsl:value-of select="$Call_KNETPayment/pfx24:ErrorResponse/pfx24:Error_UserErrDesc"/>
                    </pfx25:detail>
                </pfx25:FaultType>
                <pfx22:CreateOrderOutput>
                    <pfx22:PaymentID>
                        <xsl:value-of select="$Call_KNETPayment/pfx21:CreateOrderOutput/pfx21:PaymentID"/>
                    </pfx22:PaymentID>
                    <pfx22:PaymentPage>
                        <xsl:value-of select="$Call_KNETPayment/pfx21:CreateOrderOutput/pfx21:PaymentPage"/>
                    </pfx22:PaymentPage>
                    <pfx22:TerminalID>
                        <xsl:value-of select="$Call_KNETPayment/pfx21:CreateOrderOutput/pfx21:MerchantID"/>
                    </pfx22:TerminalID>
                    <pfx22:MerchantID>
                        <xsl:value-of select="$Call_KNETPayment/pfx21:CreateOrderOutput/pfx21:TerminalID"/>
                    </pfx22:MerchantID>
                </pfx22:CreateOrderOutput>
            </root>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Java-Code-1">
        <pd:type>com.tibco.plugin.java.JavaActivity</pd:type>
        <pd:resourceType>ae.javapalette.javaActivity</pd:resourceType>
        <pd:x>403</pd:x>
        <pd:y>35</pd:y>
        <config>
            <fileName>KNETPaymentJavaCode1</fileName>
            <packageName>BusinessProcesses.Services.New_KNET_CreateOrder.Implementation.KNETPayment</packageName>
            <fullsource>package BusinessProcesses.Services.New_KNET_CreateOrder.Implementation.KNETPayment;
import java.util.*;
import java.io.*;
import java.io.UnsupportedEncodingException;
import java.net.URLDecoder;
import java.net.URLEncoder;
public class KNETPaymentJavaCode1{
/****** START SET/GET METHOD, DO NOT MODIFY *****/
	protected String returnURL = "";
	protected String errorURL = "";
	protected String orderDesc = "";
	protected String Return_URL = "";
	protected String Error_URL = "";
	protected String Order_DESC = "";
	public String getreturnURL() {
		return returnURL;
	}
	public void setreturnURL(String val) {
		returnURL = val;
	}
	public String geterrorURL() {
		return errorURL;
	}
	public void seterrorURL(String val) {
		errorURL = val;
	}
	public String getorderDesc() {
		return orderDesc;
	}
	public void setorderDesc(String val) {
		orderDesc = val;
	}
	public String getReturn_URL() {
		return Return_URL;
	}
	public void setReturn_URL(String val) {
		Return_URL = val;
	}
	public String getError_URL() {
		return Error_URL;
	}
	public void setError_URL(String val) {
		Error_URL = val;
	}
	public String getOrder_DESC() {
		return Order_DESC;
	}
	public void setOrder_DESC(String val) {
		Order_DESC = val;
	}
/****** END SET/GET METHOD, DO NOT MODIFY *****/
	public KNETPaymentJavaCode1() {
	}
	public void invoke() throws Exception {
/* Available Variables: DO NOT MODIFY
	In  : String returnURL
	In  : String errorURL
	In  : String orderDesc
	Out : String Return_URL
	Out : String Error_URL
	Out : String Order_DESC
* Available Variables: DO NOT MODIFY *****/


try {

//	String url = "&lt;![CDATA[ &lt;IMG SRC=\" <?tibco-char E?> javascript:document.vulnerable=true;\"&gt; ]]&gt;";
	Return_URL = URLEncoder.encode(returnURL, "UTF-8");
	Error_URL = URLEncoder.encode(errorURL, "UTF-8");
	Order_DESC = URLEncoder.encode(orderDesc, "UTF-8");
	//System.out.println("Encoded URL " + encodedUrl);

	//String decodedUrl = URLDecoder.decode(url, "UTF-8");

	//System.out.println("Final URL " + EncodedURL);

	} catch (UnsupportedEncodingException e) {

		System.err.println(e);

	}

}
}
</fullsource>
            <outputData>
                <row>
                    <fieldName>Return_URL</fieldName>
                    <fieldType>string</fieldType>
                    <fieldRequired>optional</fieldRequired>
                </row>
                <row>
                    <fieldName>Error_URL</fieldName>
                    <fieldType>string</fieldType>
                    <fieldRequired>optional</fieldRequired>
                </row>
                <row>
                    <fieldName>Order_DESC</fieldName>
                    <fieldType>string</fieldType>
                    <fieldRequired>optional</fieldRequired>
                </row>
            </outputData>
            <inputData>
                <row>
                    <fieldName>returnURL</fieldName>
                    <fieldType>string</fieldType>
                    <fieldRequired>optional</fieldRequired>
                </row>
                <row>
                    <fieldName>errorURL</fieldName>
                    <fieldType>string</fieldType>
                    <fieldRequired>optional</fieldRequired>
                </row>
                <row>
                    <fieldName>orderDesc</fieldName>
                    <fieldType>string</fieldType>
                    <fieldRequired>optional</fieldRequired>
                </row>
            </inputData>
            <byteCode>
                <class>
                    <name>KNETPaymentJavaCode1</name>
                    <byteCode>yv66vgAAADMATAkADgAwCQAOADEJAA4AMgkADgAzCQAOADQJAA4ANQoADwA2CAA3CAA4CgA5ADoHADsJADwAPQoAPgA/BwBABwBBAQAJcmV0dXJuVVJMAQASTGphdmEvbGFuZy9TdHJpbmc7AQAIZXJyb3JVUkwBAAlvcmRlckRlc2MBAApSZXR1cm5fVVJMAQAJRXJyb3JfVVJMAQAKT3JkZXJfREVTQwEADGdldHJldHVyblVSTAEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEADHNldHJldHVyblVSTAEAFShMamF2YS9sYW5nL1N0cmluZzspVgEAC2dldGVycm9yVVJMAQALc2V0ZXJyb3JVUkwBAAxnZXRvcmRlckRlc2MBAAxzZXRvcmRlckRlc2MBAA1nZXRSZXR1cm5fVVJMAQANc2V0UmV0dXJuX1VSTAEADGdldEVycm9yX1VSTAEADHNldEVycm9yX1VSTAEADWdldE9yZGVyX0RFU0MBAA1zZXRPcmRlcl9ERVNDAQAGPGluaXQ+AQADKClWAQAGaW52b2tlAQANU3RhY2tNYXBUYWJsZQcAOwEACkV4Y2VwdGlvbnMHAEIBAApTb3VyY2VGaWxlAQAZS05FVFBheW1lbnRKYXZhQ29kZTEuamF2YQwAEAARDAASABEMABMAEQwAFAARDAAVABEMABYAEQwAJwAoAQAAAQAFVVRGLTgHAEMMAEQARQEAJGphdmEvaW8vVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbgcARgwARwBIBwBJDABKAEsBAF9CdXNpbmVzc1Byb2Nlc3Nlcy9TZXJ2aWNlcy9OZXdfS05FVF9DcmVhdGVPcmRlci9JbXBsZW1lbnRhdGlvbi9LTkVUUGF5bWVudC9LTkVUUGF5bWVudEphdmFDb2RlMQEAEGphdmEvbGFuZy9PYmplY3QBABNqYXZhL2xhbmcvRXhjZXB0aW9uAQATamF2YS9uZXQvVVJMRW5jb2RlcgEABmVuY29kZQEAOChMamF2YS9sYW5nL1N0cmluZztMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7AQAQamF2YS9sYW5nL1N5c3RlbQEAA2VycgEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvT2JqZWN0OylWACEADgAPAAAABgAEABAAEQAAAAQAEgARAAAABAATABEAAAAEABQAEQAAAAQAFQARAAAABAAWABEAAAAOAAEAFwAYAAEAGQAAAB0AAQABAAAABSq0AAGwAAAAAQAaAAAABgABAAAAEAABABsAHAABABkAAAAiAAIAAgAAAAYqK7UAAbEAAAABABoAAAAKAAIAAAATAAUAFAABAB0AGAABABkAAAAdAAEAAQAAAAUqtAACsAAAAAEAGgAAAAYAAQAAABYAAQAeABwAAQAZAAAAIgACAAIAAAAGKiu1AAKxAAAAAQAaAAAACgACAAAAGQAFABoAAQAfABgAAQAZAAAAHQABAAEAAAAFKrQAA7AAAAABABoAAAAGAAEAAAAcAAEAIAAcAAEAGQAAACIAAgACAAAABiortQADsQAAAAEAGgAAAAoAAgAAAB8ABQAgAAEAIQAYAAEAGQAAAB0AAQABAAAABSq0AASwAAAAAQAaAAAABgABAAAAIgABACIAHAABABkAAAAiAAIAAgAAAAYqK7UABLEAAAABABoAAAAKAAIAAAAlAAUAJgABACMAGAABABkAAAAdAAEAAQAAAAUqtAAFsAAAAAEAGgAAAAYAAQAAACgAAQAkABwAAQAZAAAAIgACAAIAAAAGKiu1AAWxAAAAAQAaAAAACgACAAAAKwAFACwAAQAlABgAAQAZAAAAHQABAAEAAAAFKrQABrAAAAABABoAAAAGAAEAAAAuAAEAJgAcAAEAGQAAACIAAgACAAAABiortQAGsQAAAAEAGgAAAAoAAgAAADEABQAyAAEAJwAoAAEAGQAAAF0AAgABAAAAKSq3AAcqEgi1AAEqEgi1AAIqEgi1AAMqEgi1AAQqEgi1AAUqEgi1AAaxAAAAAQAaAAAAIgAIAAAANAAEAAkACgAKABAACwAWAAwAHAANACIADgAoADUAAQApACgAAgAZAAAAeAADAAIAAAAzKiq0AAESCbgACrUABCoqtAACEgm4AAq1AAUqKrQAAxIJuAAKtQAGpwALTLIADCu2AA2xAAEAAAAnACoACwACABoAAAAeAAcAAABEAA0ARQAaAEYAJwBRACoATQArAE8AMgBTACoAAAAHAAJqBwArBwAsAAAABAABAC0AAQAuAAAAAgAv</byteCode>
                </class>
            </byteCode>
        </config>
        <pd:inputBindings>
            <javaCodeActivityInput>
                <returnURL>
                    <xsl:value-of select="$Parse-XML-1/pfx22:CreateOrderInput/pfx22:ReturnPage"/>
                </returnURL>
                <errorURL>
                    <xsl:value-of select="$Parse-XML-1/pfx22:CreateOrderInput/pfx22:ErrorPage"/>
                </errorURL>
                <orderDesc>
                    <xsl:value-of select="$Parse-XML-1/pfx22:CreateOrderInput/pfx22:OrderDescription"/>
                </orderDesc>
            </javaCodeActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:group name="Group">
        <pd:type>com.tibco.pe.core.LoopGroup</pd:type>
        <pd:resourceType>ae.process.group</pd:resourceType>
        <pd:x>635</pd:x>
        <pd:y>1</pd:y>
        <pd:width>132</pd:width>
        <pd:height>140</pd:height>
        <pd:collapsedWidth>57</pd:collapsedWidth>
        <pd:collapsedHeight>70</pd:collapsedHeight>
        <pd:groupVariables/>
        <pd:joinToggle>inherit</pd:joinToggle>
        <config>
            <pd:groupType>inputLoop</pd:groupType>
            <pd:serializable>false</pd:serializable>
            <pd:over>$Parse-XML-1/pfx22:CreateOrderInput/pfx22:Params/pfx22:Param</pd:over>
            <pd:iterationElementSlot>current_DPValue</pd:iterationElementSlot>
            <pd:indexSlot>i</pd:indexSlot>
            <pd:outSlot>DP_URLEncoded</pd:outSlot>
            <pd:activityOutputName>Java Code</pd:activityOutputName>
            <pd:accumulateOutput>true</pd:accumulateOutput>
        </config>
        <pd:inputBindings/>
        <pd:expanded>true</pd:expanded>
        <pd:transition>
            <pd:from>start</pd:from>
            <pd:to>Java Code</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Java Code</pd:from>
            <pd:to>end</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:activity name="Java Code">
            <pd:type>com.tibco.plugin.java.JavaActivity</pd:type>
            <pd:resourceType>ae.javapalette.javaActivity</pd:resourceType>
            <pd:x>690</pd:x>
            <pd:y>65</pd:y>
            <config>
                <fileName>KNETPaymentJavaCode</fileName>
                <packageName>BusinessProcesses.Services.New_KNET_CreateOrder.Implementation.KNETPayment</packageName>
                <fullsource>package BusinessProcesses.Services.New_KNET_CreateOrder.Implementation.KNETPayment;
import java.util.*;
import java.io.*;
import java.io.UnsupportedEncodingException;
import java.net.URLDecoder;
import java.net.URLEncoder;
public class KNETPaymentJavaCode{
/****** START SET/GET METHOD, DO NOT MODIFY *****/
	protected String DP_Value = "";
	protected String DP_UEValue = "";
	public String getDP_Value() {
		return DP_Value;
	}
	public void setDP_Value(String val) {
		DP_Value = val;
	}
	public String getDP_UEValue() {
		return DP_UEValue;
	}
	public void setDP_UEValue(String val) {
		DP_UEValue = val;
	}
/****** END SET/GET METHOD, DO NOT MODIFY *****/
	public KNETPaymentJavaCode() {
	}
	public void invoke() throws Exception {
/* Available Variables: DO NOT MODIFY
	In  : String DP_Value
	Out : String DP_UEValue
* Available Variables: DO NOT MODIFY *****/

try {

//	String url = "&lt;![CDATA[ &lt;IMG SRC=\" <?tibco-char E?> javascript:document.vulnerable=true;\"&gt; ]]&gt;";


	String decodedUrl = URLDecoder.decode(DP_Value, "UTF-8");

if (decodedUrl.length() == DP_Value.length())  {

	DP_UEValue = URLEncoder.encode(DP_Value, "UTF-8");
}
else {
DP_UEValue = DP_Value;};

	//System.out.println("Encoded URL " + encodedUrl);

	//String decodedUrl = URLDecoder.decode(url, "UTF-8");

	//System.out.println("Final URL " + EncodedURL);

	} catch (UnsupportedEncodingException e) {

		System.err.println(e);

	}}
}
</fullsource>
                <inputData>
                    <row>
                        <fieldName>DP_Value</fieldName>
                        <fieldType>string</fieldType>
                        <fieldRequired>optional</fieldRequired>
                    </row>
                </inputData>
                <outputData>
                    <row>
                        <fieldName>DP_UEValue</fieldName>
                        <fieldType>string</fieldType>
                        <fieldRequired>optional</fieldRequired>
                    </row>
                </outputData>
                <byteCode>
                    <class>
                        <name>KNETPaymentJavaCode</name>
                        <byteCode>yv66vgAAADMARAkADAAjCQAMACQKAA0AJQgAJggAJwoAKAApCgAqACsKACwALQcALgkALwAwCgAxADIHADMHADQBAAhEUF9WYWx1ZQEAEkxqYXZhL2xhbmcvU3RyaW5nOwEACkRQX1VFVmFsdWUBAAtnZXREUF9WYWx1ZQEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAC3NldERQX1ZhbHVlAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQANZ2V0RFBfVUVWYWx1ZQEADXNldERQX1VFVmFsdWUBAAY8aW5pdD4BAAMoKVYBAAZpbnZva2UBAA1TdGFja01hcFRhYmxlBwA1BwAuAQAKRXhjZXB0aW9ucwcANgEAClNvdXJjZUZpbGUBABhLTkVUUGF5bWVudEphdmFDb2RlLmphdmEMAA4ADwwAEAAPDAAZABoBAAABAAVVVEYtOAcANwwAOAA5BwA1DAA6ADsHADwMAD0AOQEAJGphdmEvaW8vVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbgcAPgwAPwBABwBBDABCAEMBAF5CdXNpbmVzc1Byb2Nlc3Nlcy9TZXJ2aWNlcy9OZXdfS05FVF9DcmVhdGVPcmRlci9JbXBsZW1lbnRhdGlvbi9LTkVUUGF5bWVudC9LTkVUUGF5bWVudEphdmFDb2RlAQAQamF2YS9sYW5nL09iamVjdAEAEGphdmEvbGFuZy9TdHJpbmcBABNqYXZhL2xhbmcvRXhjZXB0aW9uAQATamF2YS9uZXQvVVJMRGVjb2RlcgEABmRlY29kZQEAOChMamF2YS9sYW5nL1N0cmluZztMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7AQAGbGVuZ3RoAQADKClJAQATamF2YS9uZXQvVVJMRW5jb2RlcgEABmVuY29kZQEAEGphdmEvbGFuZy9TeXN0ZW0BAANlcnIBABVMamF2YS9pby9QcmludFN0cmVhbTsBABNqYXZhL2lvL1ByaW50U3RyZWFtAQAHcHJpbnRsbgEAFShMamF2YS9sYW5nL09iamVjdDspVgAhAAwADQAAAAIABAAOAA8AAAAEABAADwAAAAYAAQARABIAAQATAAAAHQABAAEAAAAFKrQAAbAAAAABABQAAAAGAAEAAAAMAAEAFQAWAAEAEwAAACIAAgACAAAABiortQABsQAAAAEAFAAAAAoAAgAAAA8ABQAQAAEAFwASAAEAEwAAAB0AAQABAAAABSq0AAKwAAAAAQAUAAAABgABAAAAEgABABgAFgABABMAAAAiAAIAAgAAAAYqK7UAArEAAAABABQAAAAKAAIAAAAVAAUAFgABABkAGgABABMAAAA1AAIAAQAAABEqtwADKhIEtQABKhIEtQACsQAAAAEAFAAAABIABAAAABgABAAJAAoACgAQABkAAQAbABoAAgATAAAAjgADAAIAAAA8KrQAARIFuAAGTCu2AAcqtAABtgAHoAATKiq0AAESBbgACLUAAqcACyoqtAABtQACpwALTLIACiu2AAuxAAEAAAAwADMACQACABQAAAAiAAgAAAAlAAoAJwAYACkAKAAsADAAOAAzADQANAA2ADsAOAAcAAAAEAAE/AAoBwAd+gAHQgcAHgcAHwAAAAQAAQAgAAEAIQAAAAIAIg==</byteCode>
                    </class>
                </byteCode>
            </config>
            <pd:inputBindings>
                <javaCodeActivityInput>
                    <DP_Value>
                        <xsl:value-of select="$current_DPValue/pfx22:Param/pfx22:Value"/>
                    </DP_Value>
                </javaCodeActivityInput>
            </pd:inputBindings>
        </pd:activity>
    </pd:group>
    <pd:transition>
        <pd:from>Map_Params</pd:from>
        <pd:to>Transform XML</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Transform XML</pd:from>
        <pd:to>Parse XML</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>JMS Queue Receiver</pd:from>
        <pd:to>Parse-XML-1</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>HTTP_String</pd:from>
        <pd:to>Call_KNETPayment</pd:to>
        <pd:lineType>Multiple Bends</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Parse XML</pd:from>
        <pd:to>Transform-DP</pd:to>
        <pd:lineType>Multiple Bends</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Transform-DP</pd:from>
        <pd:to>Transform-Parameters</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Transform-Parameters</pd:from>
        <pd:to>HTTP_String</pd:to>
        <pd:lineType>Multiple Bends</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Call_KNETPayment</pd:from>
        <pd:to>LogOUT</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>LogOUT</pd:from>
        <pd:to>Map Data</pd:to>
        <pd:lineType>Multiple Bends</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Parse-XML-1</pd:from>
        <pd:to>LogIN</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Reply to JMS Message</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>LogIN</pd:from>
        <pd:to>Java-Code-1</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Parse-XML-1</pd:from>
        <pd:to>Generate Error</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>error</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Parse XML</pd:from>
        <pd:to>Generate-Error-1</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>error</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>JMS Queue Receiver</pd:from>
        <pd:to>Generate-Error-3</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>error</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Reply to JMS Message</pd:from>
        <pd:to>Generate-Error-2</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>error</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Catch</pd:from>
        <pd:to>LogError</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>LogError</pd:from>
        <pd:to>Map_Error</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Map_Error</pd:from>
        <pd:to>Reply-to-JMS-Message-1</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Reply-to-JMS-Message-1</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>One Bend</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Map Data</pd:from>
        <pd:to>Reply to JMS Message</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Java-Code-1</pd:from>
        <pd:to>Map_Initial_Data</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Map_Initial_Data</pd:from>
        <pd:to>Group</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Group</pd:from>
        <pd:to>Map_Params</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
</pd:ProcessDefinition>